<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Basic workflow: enb.atable.ATable &mdash; Experiment Notebook MIT License documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/enb-rtd.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Experiments = data + tasks" href="experiments.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Experiment Notebook
            <img src="_static/enb_logo_small.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                v0.4.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Documentation contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Basic workflow: <code class="xref py py-class docutils literal notranslate"><span class="pre">enb.atable.ATable</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#data-curation"><strong>1 - Data curation</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#simple-column-definition"><strong>2 - Simple column definition</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#retrieving-a-results-table"><strong>3 - Retrieving a results table</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-analysis-and-plotting"><strong>4 - Data analysis and plotting</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="#adding-more-columns"><strong>5 - Adding more columns</strong></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="experiments.html">Experiments = data + tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="analyzing_data.html">Result analysis and plotting with <code class="xref py py-mod docutils literal notranslate"><span class="pre">enb</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="image_compression.html">Image compression experiments</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_curation.html">Dataset curation and modification</a></li>
<li class="toctree-l1"><a class="reference internal" href="command_line_interface.html">The <cite>enb</cite> command-line tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="cluster_setup.html">Configuring <cite>enb</cite> in a cluster of computers</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="thanks.html">Thanks</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Experiment Notebook</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Basic workflow: <code class="xref py py-class docutils literal notranslate"><span class="pre">enb.atable.ATable</span></code></li>
      <li class="wy-breadcrumbs-aside">
              <!-- User defined GitHub URL -->
              <a href="https://github.com/miguelinux314/experiment-notebook" class="fa fa-github"> enb on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="basic-workflow-atable">
<h1>Basic workflow: <a class="reference internal" href="api/enb.html#enb.atable.ATable" title="enb.atable.ATable"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.atable.ATable</span></code></a><a class="headerlink" href="#basic-workflow-atable" title="Permalink to this heading"></a></h1>
<p>This page explains the most basic workflow with <code class="docutils literal notranslate"><span class="pre">enb</span></code> with a
<a class="reference external" href="https://github.com/miguelinux314/experiment-notebook/tree/dev/enb/plugins/template_basic_workflow_example">simple example</a>.
In this example, <a class="reference internal" href="api/enb.html#enb.atable.ATable" title="enb.atable.ATable"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.atable.ATable</span></code></a> is subclassed to gather some statistics about a text corpus.
You can look at the sources in that link, or install a self-contained version with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">enb</span> <span class="n">plugin</span> <span class="n">install</span> <span class="n">basic</span><span class="o">-</span><span class="n">workflow</span> <span class="n">bw</span>
</pre></div>
</div>
<p>Then, classes from the <a class="reference internal" href="api/enb.html#module-enb.aanalysis" title="enb.aanalysis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">enb.aanalysis</span></code></a> module are used to summarize and plot the obtained results.
A diagram depicting these main stages is shown next. These stages are addressed
one by one in the remainder of this page.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="_images/general_structure.png"><img alt="Basic steps when using ``enb`` with an |ATable| subclass." src="_images/general_structure.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Basic steps when using <code class="docutils literal notranslate"><span class="pre">enb</span></code> with an <a class="reference internal" href="api/enb.html#enb.atable.ATable" title="enb.atable.ATable"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.atable.ATable</span></code></a> subclass.</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<section id="data-curation">
<h2><strong>1 - Data curation</strong><a class="headerlink" href="#data-curation" title="Permalink to this heading"></a></h2>
<p>The first step is to gather and curate your data samples.
For instance, if you work in image processing, each sample could be one
of your test images, if you work with genetic sequences, each file could
be one sequence, etc.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is best practice to separate data samples from
test parameters, e.g., arguments to the algorithm(s) used to process
each of your samples. A good way to define parameter sets is through
the <a class="reference internal" href="api/enb.html#enb.experiment.Experiment" title="enb.experiment.Experiment"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.experiment.Experiment</span></code></a> and <a class="reference internal" href="api/enb.html#enb.experiment.ExperimentTask" title="enb.experiment.ExperimentTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.experiment.ExperimentTask</span></code></a> classes, covered later in the documentation.</p>
</div>
</div></blockquote>
<p>In this basic example, each sample is the text source of a Wikipedia article. We have
the following files under the <cite>./data/wiki/</cite> folder:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>a_turing.txt
c_shannon.txt
d_knuth.txt
k_popper.txt
m_curie.txt
n_chomsky.txt
r_franklin.txt
s_beauvoir.txt
scientific_method.txt
</pre></div>
</div>
<p>We will want to tell <a class="reference internal" href="api/enb.html#module-enb" title="enb"><code class="xref py py-mod docutils literal notranslate"><span class="pre">enb</span></code></a> that these are our input
One can gather all such input samples with a single line (after <cite>import glob</cite>):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sample_paths</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;./data/wiki/*.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>For now our test dataset is all set!</p>
</section>
<section id="simple-column-definition">
<h2><strong>2 - Simple column definition</strong><a class="headerlink" href="#simple-column-definition" title="Permalink to this heading"></a></h2>
<p>The second step consists in defining the column functions(s) that produce the desired results.
With <a class="reference internal" href="api/enb.html#module-enb" title="enb"><code class="xref py py-mod docutils literal notranslate"><span class="pre">enb</span></code></a> you decide what columns (fields) are computed for each input. Results for each input
are then automatically stored in a different row per input.</p>
<p>The easiest way is to define a custom column is to inherit from <a class="reference internal" href="api/enb.html#enb.atable.ATable" title="enb.atable.ATable"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.atable.ATable</span></code></a> and
define a <cite>def column_XYZ(self, index, row)</cite> method, where XYZ is the name of your
column. That method should process the input <cite>index</cite> (in this example, the path to a <cite>.txt</cite> file)
and return the value of XYZ for that input.</p>
<p>For instance,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WikiTable</span><span class="p">(</span><span class="n">enb</span><span class="o">.</span><span class="n">atable</span><span class="o">.</span><span class="n">ATable</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">column_line_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Computes the number of lines in the input .txt file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_file</span><span class="p">)</span>
</pre></div>
</div>
<p>creates a <cite>WikiTable</cite> class that contains a <cite>line_count</cite> column. This is all we need for now.</p>
</section>
<section id="retrieving-a-results-table">
<h2><strong>3 - Retrieving a results table</strong><a class="headerlink" href="#retrieving-a-results-table" title="Permalink to this heading"></a></h2>
<p>At this point we are ready to retrieve our table of results. To do so, we call the <cite>get_df</cite> method
from <a class="reference internal" href="api/enb.html#enb.atable.ATable" title="enb.atable.ATable"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.atable.ATable</span></code></a> subclasses such as the <cite>WikiTable</cite> class we just defined:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">result_df</span> <span class="o">=</span> <span class="n">WikiTable</span><span class="p">()</span><span class="o">.</span><span class="n">get_df</span><span class="p">(</span><span class="n">target_indices</span><span class="o">=</span><span class="n">sample_paths</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, <cite>result_df</cite> is a <a class="reference external" href="https://pandas.pydata.org/pandas-docs/dev/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.0.0.dev0+463.g1e5fee83f9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> instance contains one row per element in <cite>sample_paths</cite>.
The <a class="reference internal" href="api/enb.html#module-enb" title="enb"><code class="xref py py-mod docutils literal notranslate"><span class="pre">enb</span></code></a> provides tools for analyzing and plotting results for columns you define.
Notwithstanding, you can use <cite>result_df</cite> directly as the full-fledged <a class="reference external" href="https://pandas.pydata.org/pandas-docs/dev/index.html#module-pandas" title="(in pandas v2.0.0.dev0+463.g1e5fee83f9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pandas</span></code></a> dataframe it is.
For instance, you can access and print the <cite>line_count</cite> column as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">result_df</span><span class="p">[[</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;line_count&quot;</span><span class="p">]])</span>
</pre></div>
</div>
<p>Which should produce something similar to the following (ignoring the private column <cite>__atable_index</cite>):</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                     index  line_count
   ./data/wiki/d_knuth.txt         373
./data/wiki/s_beauvoir.txt         292
 ./data/wiki/c_shannon.txt         343
   ./data/wiki/m_curie.txt         538
./data/wiki/r_franklin.txt         419
  ./data/wiki/a_turing.txt         430
 ./data/wiki/n_chomsky.txt        1854
  ./data/wiki/k_popper.txt         533
</pre></div>
</div>
</section>
<section id="data-analysis-and-plotting">
<h2><strong>4 - Data analysis and plotting</strong><a class="headerlink" href="#data-analysis-and-plotting" title="Permalink to this heading"></a></h2>
<p>Once you have your result dataframe after calling <cite>get_df</cite>, there are several ways
to analyze and plot them:</p>
<ol class="arabic simple">
<li><p>You can use <a class="reference internal" href="api/enb.html#enb.aanalysis.Analyzer" title="enb.aanalysis.Analyzer"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.aanalysis.Analyzer</span></code></a> subclasses from the <a class="reference internal" href="api/enb.html#module-enb.aanalysis" title="enb.aanalysis"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.aanalysis</span></code></a> module. This is the fastest
way and the best integrated with <cite>enb</cite>. This documentation provides help
for almost exclusively this way of analysis and plotting.</p></li>
<li><p>You can combine <cite>pandas</cite>/<cite>numpy</cite>/<cite>matplotlib</cite>/<cite>seaborn</cite> manually to perform your own analysis.
The <cite>enb</cite> library does this internally for you, but this will give you total control
with the default interfaces of these libraries.</p></li>
<li><p>It is also possible to export your data in CSV and employ other tools such as
<cite>R</cite>/<cite>SPSS</cite>/<cite>Office</cite> to conduct your analysis.</p></li>
</ol>
<p>In all cases, the result dataframe may be further manipulated if needed,
e.g., using <a class="reference external" href="https://pandas.pydata.org/pandas-docs/dev/index.html#module-pandas" title="(in pandas v2.0.0.dev0+463.g1e5fee83f9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pandas</span></code></a>’ grouping and selection interface. For instance, rows with certain values in a column
may need to be discarded from the analysis.</p>
<p>Using approach (1) above, i.e., pure <cite>enb</cite>, there are several tools at your avail
to analyze and report one or more data columns from a dataframe returned by <a class="reference internal" href="api/enb.html#enb.atable.ATable" title="enb.atable.ATable"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.atable.ATable</span></code></a>’s <cite>get_df</cite> method.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="analyzing_data.html"><span class="doc">Result analysis and plotting with enb</span></a> page provides detailed information on how to analyze and plot
different types of data with <a class="reference internal" href="api/enb.html#module-enb" title="enb"><code class="xref py py-mod docutils literal notranslate"><span class="pre">enb</span></code></a>, using the <a class="reference internal" href="api/enb.html#module-enb.aanalysis" title="enb.aanalysis"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.aanalysis</span></code></a> module.</p></li>
<li><p>You can use <a class="reference internal" href="api/enb.html#module-enb.aanalysis" title="enb.aanalysis"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.aanalysis</span></code></a> tools also for <a class="reference external" href="https://pandas.pydata.org/pandas-docs/dev/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.0.0.dev0+463.g1e5fee83f9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> instances obtained from <a class="reference external" href="https://pandas.pydata.org/pandas-docs/dev/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.0.0.dev0+463.g1e5fee83f9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> instances
directly obtained from CSV files (e.g., produced by some other tool).</p></li>
</ul>
</div>
<p>The most basic automatic analyzer is <a class="reference internal" href="api/enb.html#enb.aanalysis.ScalarNumericAnalyzer" title="enb.aanalysis.ScalarNumericAnalyzer"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.aanalysis.ScalarNumericAnalyzer</span></code></a>.
By default, it produces an histogram of the values of a given data column, in addition to average values
and +/- 1 standard deviation error bars. The following example shows how to show a basic
plot related to the <cite>line_count</cite> column defined above.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate plots and analysis dataframe.</span>
<span class="n">analysis_df</span> <span class="o">=</span> <span class="n">enb</span><span class="o">.</span><span class="n">aanalysis</span><span class="o">.</span><span class="n">ScalarNumericAnalyzer</span><span class="p">()</span><span class="o">.</span><span class="n">get_df</span><span class="p">(</span>
    <span class="n">full_df</span><span class="o">=</span><span class="n">result_df</span><span class="p">,</span>
    <span class="n">target_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;line_count&quot;</span><span class="p">])</span>

<span class="c1"># Save analysis dataframe to CSV.</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;analysis&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">analysis_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;analysis/line_count_analysis.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can <a class="reference external" href="_static/basic_workflow/ScalarNumericAnalyzer_line_count_groupby-None_histogram.pdf">download the resulting figure</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">full_df</span></code> is the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/dev/reference/api/pandas.DataFrame.html#pandas.DataFrame" title="(in pandas v2.0.0.dev0+463.g1e5fee83f9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code></a> instance produced by <a class="reference internal" href="api/enb.html#enb.atable.ATable" title="enb.atable.ATable"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.atable.ATable</span></code></a>.</p></li>
</ul>
</div>
<p>Note that several grouping options are available when reporting data.
For instance, you can use the name of a column to split the full dataframe into
subgroups based on the value of that column.</p>
<p>For instance,
if the <code class="docutils literal notranslate"><span class="pre">status</span></code> column is defined in the <code class="docutils literal notranslate"><span class="pre">WikiTable</span></code> class of our example as follows,</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@enb</span><span class="o">.</span><span class="n">atable</span><span class="o">.</span><span class="n">column_function</span><span class="p">(</span><span class="n">enb</span><span class="o">.</span><span class="n">atable</span><span class="o">.</span><span class="n">ColumnProperties</span><span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">set_dead_person</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
     <span class="n">row</span><span class="p">[</span><span class="n">_column_name</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;dead&quot;</span> <span class="k">if</span> <span class="s2">&quot;death_place&quot;</span> <span class="ow">in</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;alive&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>then one can make a grouped analysis with the following code snippet:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">scalar_analyzer</span><span class="o">.</span><span class="n">analyze_df</span><span class="p">(</span>
        <span class="n">full_df</span><span class="o">=</span><span class="n">result_df</span><span class="p">,</span>
        <span class="n">target_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;word_count&quot;</span><span class="p">],</span>
        <span class="n">group_by</span><span class="o">=</span><span class="s2">&quot;status&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>A sample plot produced by this <a class="reference external" href="https://raw.githubusercontent.com/miguelinux314/experiment-notebook/master/enb/plugins/template_basic_workflow_example/basic_workflow.py">full script</a> is shown next.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="_images/ScalarNumericAnalyzer_word_count_groupby-status_histogram.png"><img alt="_images/ScalarNumericAnalyzer_word_count_groupby-status_histogram.png" src="_images/ScalarNumericAnalyzer_word_count_groupby-status_histogram.png" style="width: 100%;" /></a>
</figure>
</section>
<section id="adding-more-columns">
<h2><strong>5 - Adding more columns</strong><a class="headerlink" href="#adding-more-columns" title="Permalink to this heading"></a></h2>
<p>So far, our <cite>WikiTable</cite> class has defined a single column of information, that is computed
for each input index. Each input index is then stored in its own row.
You can extend your <a class="reference internal" href="api/enb.html#enb.atable.ATable" title="enb.atable.ATable"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.atable.ATable</span></code></a> subclasses with as many columns as needed.
To do so you can inherit from other <a class="reference internal" href="api/enb.html#enb.atable.ATable" title="enb.atable.ATable"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.atable.ATable</span></code></a> classes, and/or define new columns.</p>
<p>To <strong>inherit</strong> all columns defined in, e.g., <cite>WikiTable</cite>, regular python
inheritance is sufficent. For instance, the following class <cite>NewWikiTable</cite>
automatically contains all columns defined for <cite>WikiTable</cite>:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NewWikiTable</span><span class="p">(</span><span class="n">WikiTable</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">column_new_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
       <span class="c1"># ...</span>
</pre></div>
</div>
</div></blockquote>
<p>To <strong>define custom columns</strong> for your class, you can add <cite>column_*</cite> methods
to your <a class="reference internal" href="api/enb.html#enb.atable.ATable" title="enb.atable.ATable"><code class="xref py py-class docutils literal notranslate"><span class="pre">enb.atable.ATable</span></code></a> subclass as in Section 2, or you can use the &#64;enb.atable.column_function decorator
as in the following example:</p>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">WikiTable</span><span class="p">(</span><span class="n">enb</span><span class="o">.</span><span class="n">atable</span><span class="o">.</span><span class="n">ATable</span><span class="p">):</span>
    <span class="c1"># Methods that start with column_ are automatically recognized as such.</span>
    <span class="c1"># They just need to return the intended value.</span>
    <span class="k">def</span> <span class="nf">column_line_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_file</span><span class="p">)</span>

    <span class="c1"># More information about a column can be provided</span>
    <span class="c1"># Several column names and/or enb.atable.ColumnProperties instances</span>
    <span class="c1"># can also be passed as *args to the decorator to define multiple columns</span>
    <span class="nd">@enb</span><span class="o">.</span><span class="n">atable</span><span class="o">.</span><span class="n">column_function</span><span class="p">(</span>
        <span class="n">enb</span><span class="o">.</span><span class="n">atable</span><span class="o">.</span><span class="n">ColumnProperties</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;word_count&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Word count&quot;</span><span class="p">,</span> <span class="n">plot_min</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="s2">&quot;status&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_word_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;word_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;dead&quot;</span> <span class="k">if</span> <span class="s2">&quot;death_place&quot;</span> <span class="ow">in</span> <span class="n">contents</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;alive&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>The &#64;enb.atable.column_function decorator is the most general way of defining new
columns. In general, to employ it:</p>
<blockquote>
<div><ul class="simple">
<li><p>Define a method <code class="docutils literal notranslate"><span class="pre">f</span></code> with interface <code class="docutils literal notranslate"><span class="pre">f(self,</span> <span class="pre">file_path,</span> <span class="pre">row)</span></code>. The <code class="docutils literal notranslate"><span class="pre">file_path</span></code>
argument is the path to one test sample (e.g., <code class="docutils literal notranslate"><span class="pre">./data/wiki/s_beauvoir.txt</span></code>.
The <code class="docutils literal notranslate"><span class="pre">row</span></code> argument is a dict-like instance, into which the desired result (for this input sample)
is to be stored.</p></li>
<li><p>Decorate the method with <code class="docutils literal notranslate"><span class="pre">&#64;enb.atable.column_function(column_name)</span></code>, where
<code class="docutils literal notranslate"><span class="pre">column_name</span></code> is a unique name that identifies the result produced by the method.</p></li>
<li><p>It is not recommended to decorate functions with name starting with <cite>column_</cite>.</p></li>
<li><p>Methods decorated with  &#64;enb.atable.column_function should not return the computed
value, but instead assign it to its <cite>row</cite> argument, i.e., they should update
the current row directly.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">enb.atable.column_function</span></code> decorator accepts <code class="docutils literal notranslate"><span class="pre">enb.atable.ColumnProperties</span></code>
instances. These column properties describe not only the unique name for the data
column, but also other information useful for reporting the obtained results.</p></li>
<li><p>The <cite>_column_name</cite> global is defined whenever a <code class="docutils literal notranslate"><span class="pre">column_function</span></code>-decorated method
is called, containing the unique column name being computed. The use of this global
is totally optional, but enables less error-prone column renaming.</p></li>
</ul>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Putting everything together, here’s the <a class="reference external" href="https://raw.githubusercontent.com/miguelinux314/experiment-notebook/master/enb/plugins/template_basic_workflow_example/basic_workflow.py">full source code</a>
of this basic workflow example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">enb.atable</span>
<span class="kn">import</span> <span class="nn">enb.aanalysis</span>


<span class="k">class</span> <span class="nc">WikiTable</span><span class="p">(</span><span class="n">enb</span><span class="o">.</span><span class="n">atable</span><span class="o">.</span><span class="n">ATable</span><span class="p">):</span>
    <span class="c1"># Methods that start with column_ are automatically recognized as such.</span>
    <span class="c1"># They just need to return the intended value.</span>
    <span class="k">def</span> <span class="nf">column_line_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">input_file</span><span class="p">)</span>

    <span class="c1"># More information about a column can be provided</span>
    <span class="c1"># Several column names and/or enb.atable.ColumnProperties instances</span>
    <span class="c1"># can also be passed as *args to the decorator to define multiple columns</span>
    <span class="nd">@enb</span><span class="o">.</span><span class="n">atable</span><span class="o">.</span><span class="n">column_function</span><span class="p">(</span>
        <span class="n">enb</span><span class="o">.</span><span class="n">atable</span><span class="o">.</span><span class="n">ColumnProperties</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;word_count&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Word count&quot;</span><span class="p">,</span> <span class="n">plot_min</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="s2">&quot;status&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">set_word_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
            <span class="n">contents</span> <span class="o">=</span> <span class="n">input_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;word_count&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">contents</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
            <span class="n">row</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;dead&quot;</span> <span class="k">if</span> <span class="s2">&quot;death_place&quot;</span> <span class="ow">in</span> <span class="n">contents</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;alive&quot;</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c1"># Step 1: get a list of all data samples</span>
    <span class="n">sample_paths</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;./data/wiki/*.txt&quot;</span><span class="p">)</span>

    <span class="c1"># Step 2: run experiment to gather data</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">WikiTable</span><span class="p">()</span> <span class="c1"># csv_support_path=&quot;persistence_basic_workflow.csv&quot;)</span>
    <span class="n">result_df</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">get_df</span><span class="p">(</span><span class="n">target_indices</span><span class="o">=</span><span class="n">sample_paths</span><span class="p">)</span>

    <span class="c1"># Show part of the returned table for the documentation.</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result_df</span><span class="p">[[</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="s2">&quot;line_count&quot;</span><span class="p">]])</span>


    <span class="c1"># Step 3: plot results</span>
    <span class="c1">#   Distribution of line counts</span>
    <span class="n">analysis_df</span> <span class="o">=</span> <span class="n">enb</span><span class="o">.</span><span class="n">aanalysis</span><span class="o">.</span><span class="n">ScalarNumericAnalyzer</span><span class="p">()</span><span class="o">.</span><span class="n">get_df</span><span class="p">(</span>
        <span class="n">full_df</span><span class="o">=</span><span class="n">result_df</span><span class="p">,</span>
        <span class="n">target_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;line_count&quot;</span><span class="p">])</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;analysis&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">analysis_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;analysis/line_count_analysis.csv&quot;</span><span class="p">)</span>

    <span class="c1">#   Distribution of word count grouped by status</span>
    <span class="n">analysis_df</span> <span class="o">=</span> <span class="n">enb</span><span class="o">.</span><span class="n">aanalysis</span><span class="o">.</span><span class="n">ScalarNumericAnalyzer</span><span class="p">()</span><span class="o">.</span><span class="n">get_df</span><span class="p">(</span>
        <span class="n">full_df</span><span class="o">=</span><span class="n">result_df</span><span class="p">,</span>
        <span class="n">target_columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;word_count&quot;</span><span class="p">],</span>
        <span class="n">group_by</span><span class="o">=</span><span class="s2">&quot;status&quot;</span><span class="p">,</span>
        <span class="n">show_global</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;analysis&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">analysis_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;analysis/word_count_analysis.csv&quot;</span><span class="p">)</span>

    <span class="c1">#   Scatter plot: line count vs word count</span>
    <span class="n">enb</span><span class="o">.</span><span class="n">aanalysis</span><span class="o">.</span><span class="n">TwoNumericAnalyzer</span><span class="p">()</span><span class="o">.</span><span class="n">get_df</span><span class="p">(</span>
        <span class="n">full_df</span><span class="o">=</span><span class="n">result_df</span><span class="p">,</span>
        <span class="n">target_columns</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot;line_count&quot;</span><span class="p">,</span> <span class="s2">&quot;word_count&quot;</span><span class="p">)],</span>
        <span class="n">column_to_properties</span><span class="o">=</span><span class="n">table</span><span class="o">.</span><span class="n">column_to_properties</span><span class="p">)</span>

    <span class="c1"># Render a PNG version as well</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s2">&quot;plots_png&quot;</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">enb</span><span class="o">.</span><span class="n">aanalysis</span><span class="o">.</span><span class="n">pdf_to_png</span><span class="p">(</span><span class="s2">&quot;plots&quot;</span><span class="p">,</span> <span class="s2">&quot;plots_png&quot;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="experiments.html" class="btn btn-neutral float-right" title="Experiments = data + tasks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020-*, Miguel Hernández-Cabronero.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>